<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>dphon.index API documentation</title>
<meta name="description" content="SpaCy pipeline components for building indices of arbitrary Token data." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>dphon.index</code></h1>
</header>
<section id="section-intro">
<p>SpaCy pipeline components for building indices of arbitrary Token data.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python
# -*- coding: utf-8 -*-
&#34;&#34;&#34;SpaCy pipeline components for building indices of arbitrary Token data.&#34;&#34;&#34;

import logging
from itertools import filterfalse
from typing import Any, Callable, Iterator, Iterable, List, Tuple, TypeVar, Optional

from spacy.language import Language
from spacy.lookups import Table
from spacy.tokens import Doc, Span, Token

# register the pipeline component factory; see:
# https://spacy.io/usage/processing-pipelines#custom-components-factories
Language.factories[&#34;index&#34;] = lambda nlp, **cfg: Index(nlp, **cfg)

KT = TypeVar(&#34;KT&#34;)              # type for keys stored in the index
VT = TypeVar(&#34;VT&#34;)              # type for values stored in the index
Entry = Tuple[KT, List[VT]]     # type for an index entry (all values at key)

# called on a Doc; returns the list of values from the doc we want to index
ValFn = Callable[[Doc], Iterable[VT]]

# called on a value; if False the value will not be indexed
FilterFn = Callable[[VT], bool]

# called on a value to index; returns the key to index at (i.e. hash)
KeyFn = Callable[[VT], KT]


class Index():
    &#34;&#34;&#34;A spaCy pipeline component that indexes arbitrary items via callables.&#34;&#34;&#34;

    name = &#34;index&#34;  # will appear in spaCy pipeline

    def __init__(self, nlp: Language, key_fn: Optional[KeyFn] = None,
                 val_fn: Optional[ValFn] = None, filter_fn: Optional[FilterFn] = None,
                 name: str = None):
        &#34;&#34;&#34;Initialize the index component.

        - By default, an index will store lists of Tokens keyed on their text.
        - Pass val_fn to control what values are extracted from a Doc.
        - Pass key_fn to control what key values are indexed at.
        - Pass filter_fn to control which values are indexed.&#34;&#34;&#34;
        # store name, callables used to index values, and total values (size)
        self.name = name if name else self.name
        self._size = 0

        # by default, extracts tokens from docs and indexes them via their text
        self.val_fn: ValFn = val_fn if val_fn else lambda doc: doc
        self.key_fn: KeyFn = key_fn if key_fn else lambda token: token.text
        self.filter_fn: FilterFn = filter_fn if filter_fn else lambda token: True

        # initialize the index
        self.table = nlp.vocab.lookups.add_table(self.name)
        logging.info(f&#34;created component \&#34;{self.name}\&#34;&#34;)

    def __call__(self, doc: Doc) -&gt; Doc:
        &#34;&#34;&#34;Extract values from a doc and index those that pass the filter.

        - Values are extracted from the doc using val_fn(doc).
        - Values that pass the predicate filter_fn(value) are indexed.
        - Values will be indexed using the output of key_fn(value).
        - The Doc is returned unmodified.&#34;&#34;&#34;

        for val in self.val_fn(doc):
            if self.filter_fn(val):
                key = self.key_fn(val)
                try:
                    self.table.get(key).append(val)
                except AttributeError:
                    self.table.set(key, [val])
                self._size += 1
        return doc

    def __len__(self) -&gt; int:
        &#34;&#34;&#34;Get the total number of keys in the index.&#34;&#34;&#34;
        return len(self.table)

    def __contains__(self, key: KT) -&gt; bool:
        &#34;&#34;&#34;Check if a key is in the index.&#34;&#34;&#34;
        return key in self.table

    def __getitem__(self, key: KT) -&gt; List[VT]:
        &#34;&#34;&#34;Return a list of all values indexed at a given key.&#34;&#34;&#34;
        return self.table.get(key)

    def __iter__(self) -&gt; Iterator[Entry]:
        &#34;&#34;&#34;Return a (k, v) iterator over all entries in the index.&#34;&#34;&#34;
        return self.filter(lambda entry: True)

    def filter(self, fn: Callable[[Entry], bool]) -&gt; Iterator[Entry]:
        &#34;&#34;&#34;Return a (k, v) iterator over all entries which match a predicate.&#34;&#34;&#34;
        return (entry for entry in self.table.items() if fn(entry))

    @property
    def size(self) -&gt; int:
        &#34;&#34;&#34;Get the total number of values in the index.&#34;&#34;&#34;
        return self._size</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="dphon.index.Index"><code class="flex name class">
<span>class <span class="ident">Index</span></span>
<span>(</span><span>nlp: spacy.language.Language, key_fn: Union[Callable[[~VT], ~KT], NoneType] = None, val_fn: Union[Callable[[spacy.tokens.doc.Doc], Iterable[~VT]], NoneType] = None, filter_fn: Union[Callable[[~VT], bool], NoneType] = None, name: str = None)</span>
</code></dt>
<dd>
<div class="desc"><p>A spaCy pipeline component that indexes arbitrary items via callables.</p>
<p>Initialize the index component.</p>
<ul>
<li>By default, an index will store lists of Tokens keyed on their text.</li>
<li>Pass val_fn to control what values are extracted from a Doc.</li>
<li>Pass key_fn to control what key values are indexed at.</li>
<li>Pass filter_fn to control which values are indexed.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Index():
    &#34;&#34;&#34;A spaCy pipeline component that indexes arbitrary items via callables.&#34;&#34;&#34;

    name = &#34;index&#34;  # will appear in spaCy pipeline

    def __init__(self, nlp: Language, key_fn: Optional[KeyFn] = None,
                 val_fn: Optional[ValFn] = None, filter_fn: Optional[FilterFn] = None,
                 name: str = None):
        &#34;&#34;&#34;Initialize the index component.

        - By default, an index will store lists of Tokens keyed on their text.
        - Pass val_fn to control what values are extracted from a Doc.
        - Pass key_fn to control what key values are indexed at.
        - Pass filter_fn to control which values are indexed.&#34;&#34;&#34;
        # store name, callables used to index values, and total values (size)
        self.name = name if name else self.name
        self._size = 0

        # by default, extracts tokens from docs and indexes them via their text
        self.val_fn: ValFn = val_fn if val_fn else lambda doc: doc
        self.key_fn: KeyFn = key_fn if key_fn else lambda token: token.text
        self.filter_fn: FilterFn = filter_fn if filter_fn else lambda token: True

        # initialize the index
        self.table = nlp.vocab.lookups.add_table(self.name)
        logging.info(f&#34;created component \&#34;{self.name}\&#34;&#34;)

    def __call__(self, doc: Doc) -&gt; Doc:
        &#34;&#34;&#34;Extract values from a doc and index those that pass the filter.

        - Values are extracted from the doc using val_fn(doc).
        - Values that pass the predicate filter_fn(value) are indexed.
        - Values will be indexed using the output of key_fn(value).
        - The Doc is returned unmodified.&#34;&#34;&#34;

        for val in self.val_fn(doc):
            if self.filter_fn(val):
                key = self.key_fn(val)
                try:
                    self.table.get(key).append(val)
                except AttributeError:
                    self.table.set(key, [val])
                self._size += 1
        return doc

    def __len__(self) -&gt; int:
        &#34;&#34;&#34;Get the total number of keys in the index.&#34;&#34;&#34;
        return len(self.table)

    def __contains__(self, key: KT) -&gt; bool:
        &#34;&#34;&#34;Check if a key is in the index.&#34;&#34;&#34;
        return key in self.table

    def __getitem__(self, key: KT) -&gt; List[VT]:
        &#34;&#34;&#34;Return a list of all values indexed at a given key.&#34;&#34;&#34;
        return self.table.get(key)

    def __iter__(self) -&gt; Iterator[Entry]:
        &#34;&#34;&#34;Return a (k, v) iterator over all entries in the index.&#34;&#34;&#34;
        return self.filter(lambda entry: True)

    def filter(self, fn: Callable[[Entry], bool]) -&gt; Iterator[Entry]:
        &#34;&#34;&#34;Return a (k, v) iterator over all entries which match a predicate.&#34;&#34;&#34;
        return (entry for entry in self.table.items() if fn(entry))

    @property
    def size(self) -&gt; int:
        &#34;&#34;&#34;Get the total number of values in the index.&#34;&#34;&#34;
        return self._size</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="dphon.index.Index.name"><code class="name">var <span class="ident">name</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="dphon.index.Index.size"><code class="name">var <span class="ident">size</span> : int</code></dt>
<dd>
<div class="desc"><p>Get the total number of values in the index.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def size(self) -&gt; int:
    &#34;&#34;&#34;Get the total number of values in the index.&#34;&#34;&#34;
    return self._size</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="dphon.index.Index.filter"><code class="name flex">
<span>def <span class="ident">filter</span></span>(<span>self, fn: Callable[[Tuple[~KT, List[~VT]]], bool]) ‑> Iterator[Tuple[~KT, List[~VT]]]</span>
</code></dt>
<dd>
<div class="desc"><p>Return a (k, v) iterator over all entries which match a predicate.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def filter(self, fn: Callable[[Entry], bool]) -&gt; Iterator[Entry]:
    &#34;&#34;&#34;Return a (k, v) iterator over all entries which match a predicate.&#34;&#34;&#34;
    return (entry for entry in self.table.items() if fn(entry))</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="dphon" href="index.html">dphon</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="dphon.index.Index" href="#dphon.index.Index">Index</a></code></h4>
<ul class="">
<li><code><a title="dphon.index.Index.filter" href="#dphon.index.Index.filter">filter</a></code></li>
<li><code><a title="dphon.index.Index.name" href="#dphon.index.Index.name">name</a></code></li>
<li><code><a title="dphon.index.Index.size" href="#dphon.index.Index.size">size</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>